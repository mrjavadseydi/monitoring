function uploaderInit(a,o=null){null==uploader&&(uploader=a.uploader());var e={};$(["url","accept","multiple","data","uploadIn","onAddFiles","onCompleteAddFiles","onProgress","onComplete","item","body","uploader"]).each(function(o,n){var t=a.attr(n);void 0!==t&&!1!==t&&(e[n]=a.attr(n))}),uploader.options(e),null!=o?uploader.addFiles(o):uploader.load()}uploader=null,function($){var input=null,options={url:null,data:null,accept:null,multiple:!0,onAddFiles:null,onProgress:null,onComplete:null,onCompleteAddFiles:null,uploadIn:1},ajax=null,uploads=[],uploadKeys=[],uploading=!1,uploadingKey=null;function uploadsPop(a){var o=Object.keys(a)[0],e=a[o];return delete a[o],e}function uploadLength(a){var o=0;for(var e in a)o++;return o}$.fn.uploader=function(){return this},$.fn.options=function(a){options=$.extend(options,a)},$.fn.load=function(){$("#javadgholipoor-uploader-input").remove(),input=$("<input/>").css("display","none").attr("type","file").attr("id","javadgholipoor-uploader-input").attr("accept",options.accept).attr("name","files"),options.multiple&&input.attr("multiple","multiple"),$("body").append(input),input[0].addEventListener("change",function(){uploader.addFiles($(this)[0].files)},!1),input.click()},$.fn.addFiles=function(files){var index=uploadLength(uploads),addedFiles={};if($.each(files,function(i,obj){var formData=new FormData,key="i"+index;if($(options.data).length>0&&$(options.data+" input").each(function(a,o){formData.append($(o).attr("name"),$(o).val())}),formData.append("file",files[i]),formData.append("uploadIn",options.uploadIn),formData.append("_token",$("meta[name=csrf-token]").attr("content")),uploads[key]={},uploads[key].key=key,uploads[key].formData=formData,null!=options.onProgress&&(uploads[key].onProgress=options.onProgress),null!=options.onComplete&&(uploads[key].onComplete=options.onComplete),addedFiles[index]={key:key,file:files[i]},null!=options.onAddFiles){var callback=eval(options.onAddFiles);"function"==typeof callback&&callback(addedFiles[index])}index++}),null!=options.onAddFiles){var callback=eval(options.onCompleteAddFiles);"function"==typeof callback&&callback(addedFiles)}uploading||(this.startUpload(),uploading=!0)},$.fn.startUpload=function(){if(uploadLength(uploads)>0){if(null==options.url)return void alert("url not found");var data=uploadsPop(uploads);uploadingKey=data.key,ajax=$.ajax({url:options.url,type:"post",data:data.formData,dataType:"json",async:!0,processData:!1,contentType:!1,xhr:function(){var myXhr=$.ajaxSettings.xhr();return myXhr.upload.addEventListener("progress",function(e){if(e.lengthComputable){var percent=parseInt(e.loaded/e.total*100)+"%";if("onProgress"in data){var callback=eval(data.onProgress);"function"==typeof callback&&callback(percent,data.key)}}}),myXhr},success:function(response){if("onComplete"in data){var callback=eval(data.onComplete);"function"==typeof callback&&(response.key=data.key,callback("success",response))}$(this).startUpload()},error:function(response){if("onComplete"in data){var callback=eval(data.onComplete);"function"==typeof callback&&(response.key=data.key,callback("error",response))}$(this).startUpload()}})}else uploading=!1},$.fn.cancel=function(a){delete uploads[a],a==uploadingKey&&ajax.abort()}}(jQuery),$(document).on("click",".uploader-click",function(){uploaderInit($(this))}),$(document).on("drop",".uploader-drag",function(a){a.stopPropagation(),a.preventDefault(),uploaderInit($(this),a.originalEvent.dataTransfer.files)}),$(document).on("click",".uploader-cancel",function(){uploader.cancel($(this).attr("id"))}),$(document).on("click","delete-image",function(){$(this).attr("attachment")});
